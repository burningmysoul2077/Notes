>  现有图神经网络皆基于邻居聚合的框架，即*为每个目标节点通过聚合其邻居刻画结构信息，进而学习目标节点的表示*。

-  因此，在建模图神经网络时，研究人员的关注重点是如何在网络上构建*聚合算子*，聚合算子的目的是刻画节点的局部结构。现有的聚合算子构建分为两类：

1.  谱域方法：利用图上卷积定理从谱域定义图卷积。
2.  空间域方法：从节点域出发，通过在节点层面定义聚合函数来聚合每个中心节点和其邻近节点。主要包括空域图卷积神经网络、GraphSAGE和图注意力网络。

# 1. 介绍

-  参考 https://archwalker.github.io/blog/2019/06/16/GNN-Spectral-Graph.html
-  **图神经网络的核心工作是对空间域 spatial domain 中节点的 Emebedding 进行卷积操作(即聚合邻居 Embedding 信息)**
-   然而图数据和图像数据的差别在于节点邻居个数、次数都是不定的，因此传统用于图像上的 CNN Convolution Operator 不能直接用在图上，因此需要从 *频谱域 Spectral Domain* 上重新定义这样的卷积操作再通过卷积定理转换回空间域上。
-  为了在频谱域和空间域中转换，需要借助傅里叶公式，并且定义了*图上傅里叶变换(从空间域变换到频谱域)* 和*图上傅里叶逆变换(从频谱域回到空间域)*的变换公式。
-  具体操作是将节点的 Embedding $f(i), i \in (1, \cdots, N)$ 通过傅里叶正变换从空间域变换到了频谱域 $\hat f$ ，在频谱域上和卷积核 $h$ 进行卷积操作，再将变换后的节点 Embedding 通过傅里叶逆变换回到空间域，参与后续的分类等任务。

---

# 2. 谱域 Spectral Domain 图卷积神经网络

>  谱域图卷积神经网络主要包括*谱卷积神经网络、切比雪夫网络和图卷积神经网络*。

-  先从信号与系统的角度讲解谱图理论，从而得到最早的谱卷积神经网络，然后通过简化得到切比雪夫网络，最后进行再次简化得到图卷积神经网络。

## 2.1 谱图理论和图卷积

-  过去几年，卷积神经网络在图像领域大放异彩。*卷积算子定义了加权和操作，其本身是聚合算子*。借助于卷积神经网络对局部结构的建模能力以及网络数据上普遍存在的节点依赖关系，通过定义网络数据上的卷积算子进而设计图神经网络已经成为其中最活跃最重要的一支。
-  但网络数据上平移不变性的缺失，给在节点域定义卷积算子带来困难。
-  **谱方法利用卷积定理从谱域定义卷积算子**。 

### 卷积定理及傅里叶变换

>  卷积定理：信号卷积的傅里叶变换等价于信号傅里叶变换的乘积： $$\mathscr F(f * g) = \mathscr F(f) \cdot \mathscr F(g)$$
-  其中的 $f, g$ 表示两个原始信号，$\mathscr F(f)$ 表示 $f$ 的傅里叶变换， $\cdot$ 表示乘积算子，$*$ 表示卷积算子

>  对公式做傅里叶逆变换，可以得到 $$f * g = \mathscr F^{-1}(\mathscr F(f) \cdot \mathscr F(g))$$
-  其中 $\mathscr F^{-1}(f)$ 表示信号 $f$ 的傅里叶逆变换。

-  利用卷积定理，可以对谱空间的信号做乘法，再利用傅里叶逆变换将信号转换到原空间来实现图卷积，从而避免了图数据不满足平移不变性而造成的卷积定义困难问题日。

### 图傅里叶变换

-  图傅里叶变换依赖于图上的拉普拉斯矩阵 $L$。对 $L$ 做谱分解，我们可以得到

$$
L = U \Lambda U^T
$$

-  其中 $\Lambda=diag( \lambda_0, \dots, \lambda_{N-1}) \in \mathbb{R}^{N \times N}$ 是特征值矩阵,  $U=[u_0, \dots, u_{N-1}] \in \mathbb{R}^{N \times N}$ 是对应的特征向量矩阵。如下图所示

![[Pasted image 20240423151135.png]]

-  图上傅里叶变换的定义依赖于拉普拉斯矩阵的特征向量。
-   以特征向量作为谱空间下的一组基底，图上信号 $x$ 的傅里叶变换为：

$$
\hat{x} = U^Tx 
$$

-  其中 $x$ 指信号在节点域的原始表示。$\hat{x}$ 指信号 $x$ 变换到谱域后的表示，$U^T$ 表示特征向量矩阵的转置，用于做傅里叶变换。
-   信号 $x$ 的傅里叶逆变换为

$$
x = U\hat{x} 
$$

### 图卷积

-  为了完成图上的卷积操作，需要**先将图进行傅里叶变化，在谱域完成卷积操作，然后再将频域信号转换为原域**。
-  将卷积核定义为 $g_{\theta}(\Lambda)$，那么卷积的频域表示可以写为，先对输入 $x$ （其输出为 $y$） 进行傅里叶变换得到 $U^T x$ （以及 $U^T y$），然后对其应用卷积核得到$$
\hat{y} = U^T y = g_{\theta}(\Lambda) U^T x
$$

-  最后，再利用傅里叶逆变换得到$$
y = U U^T y = U g_{\theta}(\Lambda) U^T x
$$

-  以上就是最重要的图卷积操作。它一般可以被简化为$$
y = g_{\theta}(U \Lambda U^T) x = g_{\theta}(L) x
$$

-  以上过程可以被表示为下图

![[Pasted image 20240423151612.png]]

-  基于此卷积算子的定义，国内外陆续涌现出一些基于卷积聚合的图神经网络。

## 2.2 谱卷积神经网络

>  谱卷积神经网络（Spectral Convolutional Neural Network）是最早提出在网络数据上构建图神经网络的方法，该方法完全按照上述得到的卷积操作，堆叠多层得到。

-  将上面公式的 $x$ 和 $y$ 替换为图上的节点特征 $H^{(l)}$ 和 $H^{(l+1)}$，那么第 $l$ 层的结构如下 $$
H^{(l+1)} = \sigma(g_{\theta}(U \Lambda U^T) H^{(l)}) 
$$

-  $\sigma$ 表示非线性激活函数。

## 2.3 图卷积神经网络

## 2.4 代码实践

---
